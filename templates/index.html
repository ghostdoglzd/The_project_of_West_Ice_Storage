<!DOCTYPE html>
<html>
<head>
    <title>Market Analysis Demo</title>
    <style>
        #basicResult {
            height: auto; /* è‡ªåŠ¨é«˜åº¦ */
            overflow-y: hidden; /* ç§»é™¤æ»šåŠ¨æ¡ */
            margin: 10px 0;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 0.5rem;
            min-height: 50px; /* æœ€å°é«˜åº¦ä¿æŒç¾è§‚ */
        }

        /* æ–°å¢ç´§å‡‘å¸ƒå±€æ ·å¼ */
        .compact-analysis {
            display: flex;
            gap: 2rem;
            align-items: center;
            padding: 0.5rem;
        }

        /* è°ƒæ•´è¯¦ç»†æŠ¥å‘ŠåŒºåŸŸå¡«å……å‰©ä½™ç©ºé—´ */
        #reportResult {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
        }

        /* åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #e74c3c;
            --text-color: #34495e;
        }

        body {
            text-align: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        .result-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* æ”¹ä¸ºä¸¤åˆ—å¸ƒå±€ */
            gap: 2rem;
            margin-top: 2rem;
            flex: 1;
            min-height: 0; /* å…è®¸å†…å®¹æ”¶ç¼© */
        }

        .result-column {
            padding: 1.5rem;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: left;
            display: flex;
            flex-direction: column;
            height: 65vh; /* å›ºå®šé«˜åº¦ */
        }

        .analysis-section {
            margin: 1.5rem 0;
            padding: 1rem;
            border: 1px solid #eee;
            border-radius: 8px;
            flex: 1;
            min-height: 0; /* å…è®¸å†…å®¹æ”¶ç¼© */
            overflow-y: auto; /* æ·»åŠ æ»šåŠ¨æ¡ */
        }

        /* æ–°å¢DeepSeekæ»šåŠ¨åŒºåŸŸæ ·å¼ */
        .deepseek-scroll {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }

        /* å…¶ä»–åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
        .highlight {
            color: var(--success-color);
            font-weight: 600;
            background-color: #e8f5e9;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
        }

        #fileInput {
            display: none;
        }

        .custom-file-upload {
            border: 2px solid var(--accent-color);
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            background: rgba(52, 152, 219, 0.1);
        }

        textarea {
            width: 80%;
            margin: 1rem auto;
            display: block;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid var(--accent-color);
            flex-shrink: 0;
        }

        button {
            padding: 0.8rem 2rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 1rem 0;
            flex-shrink: 0;
        }

        .analysis-list {
            list-style-type: none;
            padding: 0;
        }

        .analysis-item {
            margin: 0.8rem 0;
            padding: 0.8rem;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .keyword-highlight {
            color: #e74c3c;
            font-size: 1.1em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ“ˆ Market Analysis Demo</h1>
    
    <div class="input-group">
        <select id="presetSelect" class="custom-file-upload">
            <option value="">é€‰æ‹©é¢„è®¾æ–‡æœ¬</option>
            <option value="preset1">ç§‘æŠ€æ¿å—åŠ¨æ€</option>
            <option value="preset2">å…³ç¨ç›¸å…³æ–°é—»</option>
            <option value="preset3">å°ç±³æ–°é—»</option>
        </select>
        
        <label class="custom-file-upload">
            ğŸ“ ä¸Šä¼ TXTæ–‡ä»¶
            <input type="file" id="fileInput" accept=".txt">
        </label>
    </div>

    <textarea 
        id="inputText" 
        rows="6"
        placeholder="Enter today's market news here..."
    ></textarea>
    
    <button onclick="predict()">
        Analyze Text
    </button>

    <div class="result-container">
        <!-- ç¬¬ä¸€åˆ—ï¼šè¯¦ç»†æŠ¥å‘Š -->
        <div class="result-column">
            <div class="analysis-section" style="flex: 0.25;"> <!-- é«˜åº¦æ¯”ä¾‹æ”¹ä¸º1/4 -->
                <h3>ğŸ“Š åŸºç¡€åˆ†æç»“æœ</h3>
                <div id="basicResult" class="analysis-list"></div>
            </div>
            
            <div class="analysis-section" style="flex: 0.75;"> <!-- å‰©ä½™3/4ç©ºé—´ -->
                <h3>ğŸ” è¯¦ç»†æŠ¥å‘Š</h3>
                <div id="reportResult" class="analysis-list"></div>
            </div>
        </div>

        <!-- ç¬¬äºŒåˆ—ï¼šDeepSeekåˆ†æ -->
        <div class="result-column">
            <div class="analysis-section" style="flex: 2;">
                <h3>ğŸ¤– DeepSeek AIåˆ†æ</h3>
                <div id="deepseekAnalysis" class="analysis-list deepseek-scroll"></div>
            </div>
        </div>
    </div>


    <script>
        // æ–‡ä»¶ä¸Šä¼ å¤„ç†ï¼ˆä¿æŒä¸å˜ï¼‰
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type === 'text/plain') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('inputText').value = e.target.result;
                };
                reader.readAsText(file);
            }
        });

        const presetTexts = {
            preset1: "Dow Soars 500 Points as Tech Giants Report Record Profits Ahead of Earnings Season.Fed Announces Unexpected Rate Cut, Sending Wall Street into Bullish Rally.Apple Unveils Revolutionary New iPhone, Sending Tech Stocks Skyrocketing.Oil Prices Plunge 10% Amid OPEC Supply Deal Collapse, Boosting Consumer Sentiment.Healthcare Sector Surges After FDA Approves Breakthrough Cancer Drug.Tesla Stock Jumps 20% on Rumors of New China Manufacturing Deal.Wall Street Celebrates as Trade War With China Suddenly Halts, Tariffs Rolled Back.Goldman Sachs Reports Triple Quarterly Earnings, Sparking Financial Sector Rally.U.S. Unemployment Drops to 3.5%, Igniting Optimism in Retail and Consumer Stocks.Amazon Announces $10 Billion Green Energy Investment, Green Tech Stocks Surge.Pharma Giant Pfizer Secures Global Vaccine Patent, Shares Leap 15%.Bitcoin Surges Past $100K Amid Institutional Adoption Surge, Crypto Stocks Follow.Boeing Receives $15 Billion Defense Contract, Aerospace Sector Soars.Retailers Report Holiday Sales Boom, Wal-Mart and Target Shares Hit Record Highs.Federal Infrastructure Bill Passes Congress, Boosting Construction and Steel Stocks.European Central Bank Signals Support for Dollar, Strengthening U.S. Exporters.FAANG Stocks Rally 8% as Analysts Upgrade Growth Forecasts for 2024.Tesla Opens Worldâ€™s Largest Battery Plant, Shares Climb to Uncharted Heights.Consumer Confidence Index Hits 15-Year High, Driving Auto and Travel Stocks.Oil Majors Announce $50 Billion Dividend Boosts, Energy Sector Roars Back.Microsoft Acquires AI Startup for $20 Billion, Tech Sector Cheers Innovation.FDA Approves First Alzheimerâ€™s Drug, Biotech Stocks Rally Across the Board.Fed Chair Signals Pause in Rate Hikes, Bond Yields Drop and Stocks Soar.Apple Pay Launches in India, Sending Global Payment Stocks into Overdrive.U.S. GDP Growth Revised Upward to 4%, Marking Strongest Quarter Since 2008",
            preset2: "The Dow plunges 800 points as tech giants report disappointing earnings ahead of season. The Fed signals a rate hike surprise, triggering a market sell-off. Apple faces a data breach crisis, shares collapse 12%. Oil prices surge 15% after OPEC+ cuts supply, consumer stocks plunge. The FDA halts clinical trials for a leading cancer drug, biotech sector tanks. Tesla warns of production delays, stock drops 25% on supply chain woes. Trade war escalates as China imposes new tariffs, global markets reel. Goldman Sachs reports a $2 billion loss, financial stocks dive. U.S. unemployment jumps to 6.5%, retail stocks plunge on weak consumer data. Amazon faces an antitrust lawsuit, shares drop 18% amid regulatory crackdown. Pfizer loses a patent battle, shares plunge as generic competitors enter the market. Bitcoin plummets 30% after a major exchange hack, crypto stocks crash.Boeing delays 787 Dreamliner delivery, aerospace stocks collapse. Retailers report a holiday sales slump, Wal-Mart and Target shares hit 52-week lows. The infrastructure bill fails in Congress, construction stocks plunge. The ECB raises rates, weakening the dollar and harming U.S. exports. FAANG stocks crash 15% as analysts slash growth forecasts. Tesla shuts a Gigafactory over safety issues, shares plunge to an 18-month low.Consumer confidence drops to a 10-year low, auto stocks collapse. Oil majors cut dividends amid price volatility, the energy sector tanks. Microsoft loses a major cloud contract, tech stocks slide. The FDA rejects an Alzheimerâ€™s drug, the biotech sector plunges 10%. The Fed chair signals more rate hikes, bond yields spike and stocks plunge. Apple Pay faces a regulatory ban in India, payment stocks plummet. U.S. GDP growth is revised down to 1.2%, the worst quarter since 2009.",
            preset3: "Xiaomi EV Crash in Beijing Sparks Safety Concerns: Investigation Underway. High-Profile Collision Involving Xiaomi's New EV Model Raises Questions on Autonomous Driving Tech. First Reported Xiaomi SU7 Accident Triggers Calls for Regulatory Scrutiny on Emerging EV Brands."
        };
        document.getElementById('presetSelect').addEventListener('change', function(e) {
            const selectedValue = e.target.value;
            const inputText = document.getElementById('inputText');
            if (presetTexts[selectedValue]) {
                inputText.value = presetTexts[selectedValue];
            } else {
                inputText.value = ''; // å¦‚æœæœªé€‰æ‹©é¢„è®¾æ–‡æœ¬ï¼Œåˆ™æ¸…ç©ºæ–‡æœ¬æ¡†
            }
        });
        async function predict() {
        const basicDiv = document.getElementById('basicResult');
        const reportDiv = document.getElementById('reportResult');
        const deepseekDiv = document.getElementById('deepseekAnalysis');
        
        // æ¸…ç©ºå¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        [basicDiv, reportDiv, deepseekDiv].forEach(div => {
            div.innerHTML = `<div class="analysis-item">ğŸ”ƒ åˆ†æä¸­...</div>`;
        });

        const inputText = document.getElementById('inputText').value;

        try {
            const response = await fetch('/predict', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ text: inputText })
            });

            const result = await response.json();
            if (response.ok) {
                // åŸºç¡€ç»“æœå¤„ç†
                basicDiv.innerHTML = `
                    <div class="compact-analysis">
                    <div><strong>ğŸ“ˆ è¶‹åŠ¿:</strong> ${result.result}</div>
                    <div><strong>ğŸ“Š æ¦‚ç‡:</strong> ${result.probability}%</div>
                    </div>
                `;

                // ========== è¯¦ç»†æŠ¥å‘Šå¤„ç† ==========
                const reportWithKeywords = result.report
                    .replace(/\*\*(.*?)\*\*/g, '<span class="keyword-highlight">$1</span>') // å…³é”®è¯æ›¿æ¢
                    .split('\n')  // æŒ‰æ®µè½æ‹†åˆ†
                    .map(line => 
                        line.trim() ? `<div class="analysis-item">${line}</div>` : '' // ç©ºè¡Œè¿‡æ»¤
                    )
                    .join('');
                reportDiv.innerHTML = reportWithKeywords;

                // ========== DeepSeekåˆ†æå¤„ç† ==========
                const deepseekWithKeywords = result.deepseek_analysis
                    .replace(/\*\*(.*?)\*\*/g, '<span class="keyword-highlight">$1</span>') // å…³é”®è¯æ›¿æ¢
                    .split('\n')  // æŒ‰æ®µè½æ‹†åˆ†
                    .map(line => 
                        line.trim() ? `<div class="analysis-item">${line}</div>` : '' // ç©ºè¡Œè¿‡æ»¤
                    )
                    .join('');
                deepseekDiv.innerHTML = deepseekWithKeywords;

            } else {
                basicDiv.innerHTML = `<div class="analysis-item error">âš ï¸ é”™è¯¯: ${result.error}</div>`;
            }
        } catch (error) {
            basicDiv.innerHTML = `<div class="analysis-item error">âš ï¸ è¿æ¥é”™è¯¯: ${error.message}</div>`;
        }
    }
    </script>
</body>
</html>
